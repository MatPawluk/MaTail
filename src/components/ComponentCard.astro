---
// src/components/ComponentCard.astro - Enhanced responsiveness for all screen sizes
const { title, html, css, js } = Astro.props;
// Generate a unique ID for this component instance
const uniqueId = `component-${Math.random().toString(36).substring(2, 9)}`;
---

<div
	class="code-preview bg-white border border-gray-200 rounded-lg shadow-md overflow-hidden mb-8"
	id={`code-preview-${uniqueId}`}>
	<div class="p-4 sm:p-5">
		<h2 class="text-xl font-bold text-gray-800 mb-4">{title}</h2>

		<div class="tabs-wrapper">
			<!-- Desktop tabs -->
			<div class="hidden sm:flex border-b border-gray-200">
				<button
					class="tab-button active px-3 py-2 md:px-4 md:py-2 text-sm font-medium border-b-2 border-blue-600 text-blue-600 cursor-pointer"
					data-tab="preview"
					data-component-id={uniqueId}
					aria-selected="true"
					role="tab">Podgląd</button
				>
				<button
					class="tab-button px-3 py-2 md:px-4 md:py-2 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 border-transparent cursor-pointer"
					data-tab="html"
					data-component-id={uniqueId}
					aria-selected="false"
					role="tab">HTML</button
				>
				<button
					class="tab-button px-3 py-2 md:px-4 md:py-2 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 border-transparent cursor-pointer"
					data-tab="css"
					data-component-id={uniqueId}
					aria-selected="false"
					role="tab">CSS</button
				>
				<button
					class="tab-button px-3 py-2 md:px-4 md:py-2 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 border-b-2 border-transparent cursor-pointer"
					data-tab="js"
					data-component-id={uniqueId}
					aria-selected="false"
					role="tab">JS</button
				>
			</div>

			<!-- Mobile select dropdown -->
			<div class="sm:hidden mb-4">
				<label for={`tab-select-${uniqueId}`} class="sr-only">Wybierz zakładkę</label>
				<select
					id={`tab-select-${uniqueId}`}
					class="tab-select bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
					data-component-id={uniqueId}
					aria-label="Select tab">
					<option value="preview" selected>Podgląd</option>
					<option value="html">HTML</option>
					<option value="css">CSS</option>
					<option value="js">JS</option>
				</select>
			</div>

			<div class="tab-content mt-4" role="tabpanel">
				<!-- Preview tab -->
				<div class="tab-pane active" id="preview" data-component-id={uniqueId}>
					<div class="preview p-3 sm:p-4 bg-gray-50 rounded-lg relative overflow-x-auto">
						<!-- Preview area where JS will inject the component -->
						<div class="preview-area" data-component-id={uniqueId}></div>
					</div>
				</div>

				<!-- HTML tab -->
				<div class="tab-pane hidden" id="html" data-component-id={uniqueId}>
					<pre
						class="dracula-code language-html p-3 sm:p-4 rounded-lg overflow-x-auto max-h-[400px] sm:max-h-[600px]"><code class="language-html text-sm">{html}</code></pre>
				</div>

				<!-- CSS tab -->
				<div class="tab-pane hidden" id="css" data-component-id={uniqueId}>
					<pre
						class="dracula-code language-css p-3 sm:p-4 rounded-lg overflow-x-auto max-h-[400px] sm:max-h-[600px]"><code class="language-css text-sm">{css}</code></pre>
				</div>

				<!-- JS tab -->
				<div class="tab-pane hidden" id="js" data-component-id={uniqueId}>
					<pre
						class="dracula-code language-javascript p-3 sm:p-4 rounded-lg overflow-x-auto max-h-[400px] sm:max-h-[600px]"><code class="language-javascript text-sm">{js}</code></pre>
				</div>
			</div>
		</div>
	</div>

	<!-- Copy buttons -->
	<div class="flex flex-wrap justify-end items-center gap-2 p-3 sm:p-4 bg-gray-50 border-t border-gray-200">
		<button
			class="cursor-pointer copy-btn flex items-center gap-1 text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-xs sm:text-sm px-2 py-1 sm:px-3 sm:py-2 focus:outline-none transition-colors"
			data-copy-type="html"
			data-component-id={uniqueId}
			aria-label="Copy HTML">
			<svg
				xmlns="http://www.w3.org/2000/svg"
				class="h-4 w-4"
				fill="none"
				viewBox="0 0 24 24"
				stroke="currentColor"
				aria-hidden="true">
				<path
					stroke-linecap="round"
					stroke-linejoin="round"
					stroke-width="2"
					d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
				></path>
			</svg>
			<span class="hidden xs:inline">Kopiuj HTML</span>
			<span class="xs:hidden">HTML</span>
		</button>
		<button
			class="cursor-pointer copy-btn flex items-center gap-1 text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-xs sm:text-sm px-2 py-1 sm:px-3 sm:py-2 focus:outline-none transition-colors"
			data-copy-type="css"
			data-component-id={uniqueId}
			aria-label="Copy CSS">
			<svg
				xmlns="http://www.w3.org/2000/svg"
				class="h-4 w-4"
				fill="none"
				viewBox="0 0 24 24"
				stroke="currentColor"
				aria-hidden="true">
				<path
					stroke-linecap="round"
					stroke-linejoin="round"
					stroke-width="2"
					d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
				></path>
			</svg>
			<span class="hidden xs:inline">Kopiuj CSS</span>
			<span class="xs:hidden">CSS</span>
		</button>
		<button
			class="cursor-pointer copy-btn flex items-center gap-1 text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-xs sm:text-sm px-2 py-1 sm:px-3 sm:py-2 focus:outline-none transition-colors"
			data-copy-type="js"
			data-component-id={uniqueId}
			aria-label="Copy JS">
			<svg
				xmlns="http://www.w3.org/2000/svg"
				class="h-4 w-4"
				fill="none"
				viewBox="0 0 24 24"
				stroke="currentColor"
				aria-hidden="true">
				<path
					stroke-linecap="round"
					stroke-linejoin="round"
					stroke-width="2"
					d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
				></path>
			</svg>
			<span class="hidden xs:inline">Kopiuj JS</span>
			<span class="xs:hidden">JS</span>
		</button>
	</div>

	<!-- Hidden container to store component data for JS -->
	<div class="component-data-container" hidden data-component-id={uniqueId}>
		<!-- set:html is needed for HTML tags, textContent for CSS/JS -->
		<div class="component-data-html" set:html={html} />
		<div class="component-data-css">{css}</div>
		<div class="component-data-js">{js}</div>
	</div>
</div>

<style>
	/* Component card specific styles with responsive improvements */
	.tab-button,
	.copy-btn {
		transition: all 0.2s ease-in-out;
	}

	pre {
		font-family: 'JetBrains Mono', 'Fira Code', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono',
			'Courier New', monospace;
		line-height: 1.5;
		font-size: 0.875rem;
	}

	.tab-pane pre {
		max-height: 400px;
	}

	/* Tab panel visibility control */
	.tab-pane {
		display: none;
	}
	.tab-pane.active {
		display: block;
	}
	.tab-pane.hidden {
		display: none;
	}

	/* Dracula theme for code */
	.dracula-code {
		background-color: #282a36;
		color: #f8f8f2;
		text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	}

	/* Responsive styles */
	@media (max-width: 640px) {
		.preview {
			padding: 0.75rem;
		}

		pre {
			font-size: 0.75rem;
		}

		.tab-pane pre {
			max-height: 300px;
		}
	}

	/* Add an extra small breakpoint class */
	@media (min-width: 475px) {
		.xs\:inline {
			display: inline !important;
		}

		.xs\:hidden {
			display: none !important;
		}
	}
</style>

---
import { Image } from 'astro:assets';
import Logo from '../assets/logo.svg';
---

<header class="fixed top-0 left-0 w-full z-50 bg-white border-b border-gray-200 shadow-sm">
	<div class="flex items-center justify-between h-16 px-4 md:px-6">
		<div class="flex items-center">
			<button
				type="button"
				id="sidebar-toggle"
				class="p-2 mr-2 lg:hidden text-gray-500 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 transition-all"
				aria-controls="sidebar"
				aria-expanded="false">
				<span class="sr-only">Toggle sidebar</span>
				<svg
					xmlns="http://www.w3.org/2000/svg"
					width="20"
					height="20"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
					aria-hidden="true">
					<line x1="3" y1="12" x2="21" y2="12"></line>
					<line x1="3" y1="6" x2="21" y2="6"></line>
					<line x1="3" y1="18" x2="21" y2="18"></line>
				</svg>
			</button>

			<a href="/" class="flex items-center">
				<Image src={Logo} alt="MaTails Logo" class="w-8 h-8 mr-3" width={32} height={32} />
				<span class="self-center text-xl font-semibold whitespace-nowrap text-gray-800">
					Ma<span class="text-blue-600">Tails</span>
				</span>
			</a>
		</div>

		<div class="flex items-center gap-4">
            <div class="hidden md:flex space-x-1">
              <!-- GitHub -->
              <a
                href="https://github.com/MatPawluk/"
                target="_blank"
                rel="noopener noreferrer"
                class="px-4 py-2 text-sm text-gray-700 hover:text-blue-600 transition-colors duration-200 flex items-center gap-2">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  aria-hidden="true">
                  <path
                    d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"
                  ></path>
                </svg>
                <span>GitHub</span>
              </a>
              
              <!-- LinkedIn -->
              <a
                href="https://www.linkedin.com/in/mateusz-pawluk-513368271/"
                target="_blank"
                rel="noopener noreferrer"
                class="px-4 py-2 text-sm text-gray-700 hover:text-blue-600 transition-colors duration-200 flex items-center gap-2">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  aria-hidden="true">
                  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
                  <rect x="2" y="9" width="4" height="12"></rect>
                  <circle cx="4" cy="4" r="2"></circle>
                </svg>
                <span>LinkedIn</span>
              </a>
              
              <!-- Strona osobista -->
              <a
                href="https://pawlukstudio.pl"
                target="_blank"
                rel="noopener noreferrer"
                class="px-4 py-2 text-sm text-gray-700 hover:text-blue-600 transition-colors duration-200 flex items-center gap-2">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  aria-hidden="true">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="2" y1="12" x2="22" y2="12"></line>
                  <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                </svg>
                <span>pawlukstudio.pl</span>
              </a>
            </div>
          
            <!-- Mobile dropdown menu -->
            <div class="relative md:hidden">
              <button
                type="button"
                id="mobile-menu-button"
                class="flex items-center justify-center p-2 rounded-full text-gray-500 hover:text-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-200"
                aria-expanded="false"
                aria-haspopup="menu">
                <span class="sr-only">Open menu</span>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round">
                  <circle cx="12" cy="12" r="1"></circle>
                  <circle cx="19" cy="12" r="1"></circle>
                  <circle cx="5" cy="12" r="1"></circle>
                </svg>
              </button>
          
              <div
                id="mobile-dropdown"
                class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden z-50 border border-gray-200">
                <!-- GitHub -->
                <a
                  href="https://github.com/MatPawluk/MaTail"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                  GitHub
                </a>
                
                <!-- LinkedIn -->
                <a
                  href="https://www.linkedin.com/in/mateusz-pawluk-513368271/"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                  LinkedIn
                </a>
                
                <!-- Strona osobista -->
                <a
                  href="https://pawlukstudio.pl"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                  pawlukstudio.pl
                </a>
                
                <!-- info -->
                <a href="/docs" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                  Info
                </a>
              </div>
            </div>
          
            <div class="relative">
              <button
                type="button"
                class="flex text-sm bg-gray-100 rounded-full focus:ring-4 focus:ring-gray-200"
                aria-label="User profile">
                <div class="w-8 h-8 rounded-full flex items-center justify-center bg-blue-600 text-white text-xs">MP</div>
              </button>
            </div>
          </div>
	</div>
</header>

<script>
	// Enhanced script for topbar interactions
	document.addEventListener('DOMContentLoaded', () => {
		// Mobile menu toggle
		const mobileMenuButton = document.getElementById('mobile-menu-button');
		const mobileDropdown = document.getElementById('mobile-dropdown');

		if (mobileMenuButton && mobileDropdown) {
			mobileMenuButton.addEventListener('click', () => {
				const expanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
				mobileMenuButton.setAttribute('aria-expanded', (!expanded).toString());
				mobileDropdown.classList.toggle('hidden');
			});

			// Close mobile menu when clicking outside
			document.addEventListener('click', event => {
				if (!mobileMenuButton.contains(event.target as Node) && !mobileDropdown.contains(event.target as Node)) {
					mobileDropdown.classList.add('hidden');
					mobileMenuButton.setAttribute('aria-expanded', 'false');
				}
			});
		}

		// Sidebar toggle functionality
		const sidebarToggle = document.getElementById('sidebar-toggle');
		const sidebar = document.getElementById('sidebar');
		const overlay = document.getElementById('sidebar-overlay');

		if (sidebarToggle && sidebar && overlay) {
			// Toggle sidebar visibility
			sidebarToggle.addEventListener('click', () => {
				const isVisible = !sidebar.classList.contains('-translate-x-full');

				if (isVisible) {
					// Hide sidebar
					sidebar.classList.add('-translate-x-full');
					overlay.classList.add('hidden');
					document.body.classList.remove('sidebar-open');
					document.body.style.overflow = '';
					sidebarToggle.setAttribute('aria-expanded', 'false');
				} else {
					// Show sidebar
					sidebar.classList.remove('-translate-x-full');
					overlay.classList.remove('hidden');
					document.body.classList.add('sidebar-open');

					// Block scrolling on mobile
					if (window.innerWidth < 1024) {
						document.body.style.overflow = 'hidden';
					}

					sidebarToggle.setAttribute('aria-expanded', 'true');
				}
			});

			// Close sidebar when clicking the overlay
			overlay.addEventListener('click', () => {
				sidebar.classList.add('-translate-x-full');
				overlay.classList.add('hidden');
				document.body.classList.remove('sidebar-open');
				document.body.style.overflow = '';
				sidebarToggle.setAttribute('aria-expanded', 'false');
			});

			// Close sidebar with Escape key
			document.addEventListener('keydown', e => {
				if (e.key === 'Escape' && !sidebar.classList.contains('-translate-x-full')) {
					sidebar.classList.add('-translate-x-full');
					overlay.classList.add('hidden');
					document.body.classList.remove('sidebar-open');
					document.body.style.overflow = '';
					sidebarToggle.setAttribute('aria-expanded', 'false');
				}
			});
		}

		// Re-initialize after Astro page transitions
		document.addEventListener('astro:after-swap', () => {
			// Re-query elements after page swap
			const newMobileMenuButton = document.getElementById('mobile-menu-button');
			const newMobileDropdown = document.getElementById('mobile-dropdown');
			const newSidebarToggle = document.getElementById('sidebar-toggle');
			const newSidebar = document.getElementById('sidebar');
			const newOverlay = document.getElementById('sidebar-overlay');

			// Re-attach event listeners
			if (newMobileMenuButton && newMobileDropdown) {
				newMobileMenuButton.addEventListener('click', () => {
					const expanded = newMobileMenuButton.getAttribute('aria-expanded') === 'true';
					newMobileMenuButton.setAttribute('aria-expanded', (!expanded).toString());
					newMobileDropdown.classList.toggle('hidden');
				});
			}

			if (newSidebarToggle && newSidebar && newOverlay) {
				newSidebarToggle.addEventListener('click', () => {
					const isVisible = !newSidebar.classList.contains('-translate-x-full');

					if (isVisible) {
						newSidebar.classList.add('-translate-x-full');
						newOverlay.classList.add('hidden');
						document.body.classList.remove('sidebar-open');
						document.body.style.overflow = '';
						newSidebarToggle.setAttribute('aria-expanded', 'false');
					} else {
						newSidebar.classList.remove('-translate-x-full');
						newOverlay.classList.remove('hidden');
						document.body.classList.add('sidebar-open');

						if (window.innerWidth < 1024) {
							document.body.style.overflow = 'hidden';
						}

						newSidebarToggle.setAttribute('aria-expanded', 'true');
					}
				});

				newOverlay.addEventListener('click', () => {
					newSidebar.classList.add('-translate-x-full');
					newOverlay.classList.add('hidden');
					document.body.classList.remove('sidebar-open');
					document.body.style.overflow = '';
					newSidebarToggle.setAttribute('aria-expanded', 'false');
				});
			}
		});
	});
</script>

<style>
	/* Mobile responsive styles for topbar */
	@media (max-width: 639px) {
		header .text-xl {
			font-size: 1.1rem;
		}
	}
</style>
